<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- firebase app -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
    <!-- firestore -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore-compat.js"></script>

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=chevron_right"/>
</head>

<body>
<div>
    <!-- get user input -->
    <input type="text" name="message" id="msg" placeholder="typing..." value="" required>
    <button id="send-msg">
        send
        <span class="material-symbols-outlined">
                chevron_right
            </span>
    </button>

    <div id="chat"></div>
</div>

<script>
    // config firebase
    let firebaseConfig = {
        apiKey: "AIzaSyD57N2Ewp8UVtcXKmVMFyP1HeTBksh4iww",
        authDomain: "my-project-9714d.firebaseapp.com",
        databaseURL: "https://my-project-9714d-default-rtdb.firebaseio.com",
        projectId: "my-project-9714d",
        storageBucket: "my-project-9714d.firebasestorage.app",
        messagingSenderId: "84976519917",
        appId: "1:84976519917:web:1294f53b957c48e38f5ae4"
    }

    // start/initialize the firebase app
    firebase.initializeApp(firebaseConfig);

    // get button
    let bhejDo = document.getElementById('send-msg');

    // send msg function
    bhejDo.addEventListener('click', async () => {
        // getting user ka input value
        let message = document.getElementById('msg').value;

        try {
            console.log('inside the sendMsg func tion');
            let result = await firebase.firestore().collection('jh-chat').add({message});

            if (result.exists) {
                console.log(`Message send! ${result.data().message}`)

                let pElement = document.createElement('p');
                console.log(pElement);

                pElement.innerText = firebase
                    .firestore()
                    .collection('jh-chat')
                    .get().data().message
                        document.getElementById('chat').appendChild(pElement);
            }
        } catch (e) {
            console.log(`error while sending message! ${e}`)
        }

        document.getElementById('msg').value = '';

    });


    function getMsg() {
        firebase
            .firestore()
            .collection('jh-chat')
            .onSnapshot(changes => {
                changes.docChanges().forEach((change) => {
                    if (change.type == 'added') {
                        // create p tag -> innnerText -> change(messgae) -> tag append div
                    }
                })
            })
    }


    getMsg();
</script>
</body>

</html>